{% extends 'base.html' %}

{% block content %}
  <h1 class="text-4xl font-semibold my-4 ml-4">Tu Carrito de Compras</h1>
  <div class="flex w-full mt-8">
    <div class="w-8/12 mx-6" id="product-list">
      {% for product in products %}
        <div class="my-4 py-2 flex">
          <img class="h-20 w-20 object-contain" src="{{ product.image_url }}" alt="" />
          <div class="flex justify-between w-full">
            <a href="{% url 'product' product.id %}" class="w-1/3 font-bold text-2xl hover:underline">{{ product.name }}</a>

            <div class="w-1/3">${{ product.price|floatformat:'2g' }}</div>

            <div class="w-1/3 flex flex-col items-end">
              <p>${{ product.total|floatformat:'2g' }}</p>

              <div class="flex">
                <form action="{% url 'add_to_cart' product.id %}" method="POST">
                  {% csrf_token %}
                  <button class="bg-gray-100 px-2 rounded-l-lg hover:bg-gray-300 transition ring-1 ring-gray-500">+</button>
                </form>
                <div class="bg-white px-2 hover:bg-gray-300 transition ring-1 ring-gray-500">{{ product.amount }}</div>
                <form action="{% url 'decrease_cart_product' product.id %}" method="post">
                  {% csrf_token %}
                  <button class="bg-gray-100 px-2 rounded-r-lg hover:bg-gray-300 transition ring-1 ring-gray-500">-</button>
                </form>
              </div>

              <form action="{% url 'remove_product_cart' product.id %}" method="post">
                {% csrf_token %}
                <button class="text-blue-600 hover:text-blue-800 hover:underline">Eliminar</button>
              </form>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="text-4xl">No hay productos en tu carrito.</p>
        <div class="mt-4">
          {% if not user.is_authenticated %}
            <a class="text-2xl rounded-md bg-blue-500 py-2 px-5 text-white hover:bg-blue-400 transition" href="">Iniciar sesión</a>
          {% endif %}
          <a class="text-2xl rounded-md bg-gray-100 py-2 px-5 hover:bg-gray-50 transition" href="">Ver más productos</a>
        </div>
      {% endfor %}
    </div>

    {% if products %}
      <div class="bg-gray-50 rounded-lg p-4 w-4/12 h-fit">
        <div class="flex justify-between">
          <p>{{ item_count }} articulos:</p>
          <p>${{ total_price|floatformat:'2g' }}</p>
        </div>

        <div class="flex justify-between">
          <p>envío:</p>
          <p>$199.00</p>
        </div>

        <div class="flex justify-between border-t-2 my-2 pt-2">
          <strong>Total :</strong>
          <strong>${{ total_price|add:199|floatformat:'2g' }}</strong>
        </div>
        <div>
          <a href="{% url 'buy_cart' %}"><button class="w-full rounded-md bg-green-500 p-2 text-white font-semibold hover:bg-green-700 transition">Finalizar compra</button></a>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}